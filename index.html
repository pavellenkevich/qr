<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Tongue</title>
  <meta name="description" content="Minimal QR code generator: SVG / PNG / JPG with style options" />
  <meta name="theme-color" content="#f2f2f2" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <div class="app">

    <header>
      <h1>QR Tongue</h1>
      <p class="subtitle">Fully free. No ads. No login needed. By <a href="#" rel="noopener">Paulik Liankevich â†—</a></p>
    </header>

    <main>

      <!-- Your Link -->
      <section class="section">
        <label class="section-title" for="data">Your Link</label>
        <div class="input-wrapper">
          <input id="data" class="input" type="text" placeholder="https://" autocomplete="off" />
          <button class="paste-btn" id="pasteBtn" type="button">
            <img src="icons/icon_paste.svg" alt="Paste" width="20" height="20" />
            Paste
          </button>
        </div>
      </section>

      <!-- Pattern Form -->
      <section class="section">
        <label class="section-title">Pattern Form</label>
        <div class="pattern-options" id="styleTabs" role="tablist" aria-label="Pattern Form">
          <button type="button" data-style="squares" class="pattern-btn active" role="tab" aria-selected="true">
            <img src="icons/icon_pattern_square.svg" alt="Square Pattern" height="48" />
          </button>
          <button type="button" data-style="dots" class="pattern-btn" role="tab" aria-selected="false">
            <img src="icons/icon_pattern_circle.svg" alt="Circle Pattern" height="48" />
          </button>
          <button type="button" data-style="diamonds" class="pattern-btn" role="tab" aria-selected="false">
            <img src="icons/icon_pattern_romb.svg" alt="Diamond Pattern" height="48" />
          </button>
          <button type="button" data-style="hearts" class="pattern-btn" role="tab" aria-selected="false">
            <img src="icons/icon_pattern_heart.svg" alt="Heart Pattern" height="48" />
          </button>
          <button type="button" data-style="stars" class="pattern-btn" role="tab" aria-selected="false">
            <img src="icons/icon_pattern_star.svg" alt="Star Pattern" height="48" />
          </button>
        </div>
      </section>

      <!-- Colors -->
      <section class="section">
        <div class="two-columns">
          <div class="column">
            <label class="section-title">Pattern Color</label>
            <div class="color-row">
              <div class="color-swatch" style="background-color: #000000" id="colorSwatch"></div>
              <input id="color" class="color-picker" type="color" value="#000000" />
              <input id="colorHex" class="hex-input" type="text" value="#000000" maxlength="7" placeholder="#000000" />
            </div>
          </div>
          <div class="column">
            <label class="section-title">Background Color</label>
            <div class="color-row">
              <div class="color-swatch" style="background-color: #FFFFFF" id="bgColorSwatch"></div>
              <input id="bgColor" class="color-picker" type="color" value="#FFFFFF" />
              <input id="bgColorHex" class="hex-input" type="text" value="#FFFFFF" maxlength="7" placeholder="#FFFFFF" />
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Container -->

      <div class="settings-container">

        <!-- File Format & Resolution -->

        <section class="section">
          <div class="format-resolution-row">
            <div class="format-column">
              <label class="section-title">File Format</label>
              <div class="format-options" id="typeChips" role="tablist" aria-label="File Format">
                <button type="button" data-type="svg" class="format-btn active" role="tab" aria-selected="true">
                  <svg class="check-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13.5 4L6 11.5L2.5 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>SVG</span>
                </button>
                <button type="button" data-type="png" class="format-btn" role="tab" aria-selected="false">
                  <svg class="check-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13.5 4L6 11.5L2.5 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>PNG</span>
                </button>
                <button type="button" data-type="jpg" class="format-btn" role="tab" aria-selected="false">
                  <svg class="check-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13.5 4L6 11.5L2.5 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>JPG</span>
                </button>
                <button type="button" data-type="esp" class="format-btn" role="tab" aria-selected="false">
                  <svg class="check-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13.5 4L6 11.5L2.5 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>EPS</span>
                </button>
              </div>
            </div>
            <div class="format-column">
              <label class="section-title">Image Resolution</label>
              <div class="format-options" id="resolutionChips" role="tablist" aria-label="Image Resolution">
                <button type="button" data-size="512" class="format-btn" role="tab" aria-selected="false">512</button>
                <button type="button" data-size="1024" class="format-btn" role="tab" aria-selected="false">1024</button>
                <button type="button" data-size="2048" class="format-btn" role="tab" aria-selected="false">2048</button>
                <button type="button" data-size="4096" class="format-btn" role="tab" aria-selected="false">4096</button>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Download Button -->
      <button class="download-btn" id="dlBtn" disabled>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 2V12M10 12L6 8M10 12L14 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 15V17C2 18.1046 2.89543 19 4 19H16C17.1046 19 18 18.1046 18 17V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Download
      </button>
    </main>

    <!-- QR Preview Section -->
    <div class="qr-section">
      <div class="qr-preview">
        <div id="previewQR" class="preview-canvas"></div>
      </div>
    </div>
  </div>

  <!-- QR matrix lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>

  <script>
    (() => {
      // Elements
      const $ = (s) => document.querySelector(s);
      const dataEl = $('#data');
      const dlBtn = $('#dlBtn');
      const pasteBtn = $('#pasteBtn');
      const colorEl = $('#color');
      const colorHexEl = $('#colorHex');
      const colorSwatch = $('#colorSwatch');
      const bgColorEl = $('#bgColor');
      const bgColorHexEl = $('#bgColorHex');
      const bgColorSwatch = $('#bgColorSwatch');
      const resolutionChips = $('#resolutionChips');
      const previewQREl = $('#previewQR');

      // State
      let style = 'squares';
      let ftype = 'svg';
      let qrColor = '#000000';
      let bgColor = '#FFFFFF';
      let resolution = 1024;

      const styleTabs = $('#styleTabs');
      const typeChips = $('#typeChips');

      // Paste button
      pasteBtn.addEventListener('click', async () => {
        try {
          const text = await navigator.clipboard.readText();
          dataEl.value = text;
          generateQR();
        } catch (err) {
          console.error('Failed to read clipboard:', err);
        }
      });

      function isValidHex(hex) {
        return /^#[0-9A-F]{6}$/i.test(hex);
      }

      // Color picker -> HEX input sync
      colorEl.addEventListener('input', (e) => {
        qrColor = e.target.value.toUpperCase();
        colorHexEl.value = qrColor;
        colorSwatch.style.backgroundColor = qrColor;
        generateQR();
      });

      // Color swatch click -> open color picker
      colorSwatch.addEventListener('click', () => {
        colorEl.click();
      });

      // HEX input -> Color picker sync
      colorHexEl.addEventListener('input', (e) => {
        let val = e.target.value;
        if (!val.startsWith('#')) val = '#' + val;
        if (isValidHex(val)) {
          qrColor = val.toUpperCase();
          colorEl.value = qrColor;
          colorSwatch.style.backgroundColor = qrColor;
          generateQR();
        }
      });

      colorHexEl.addEventListener('blur', (e) => {
        let val = e.target.value;
        if (!val.startsWith('#')) val = '#' + val;
        if (!isValidHex(val)) {
          e.target.value = qrColor;
        } else {
          qrColor = val.toUpperCase();
          colorEl.value = qrColor;
          colorSwatch.style.backgroundColor = qrColor;
          e.target.value = qrColor;
        }
      });

      // Background color picker -> HEX input sync
      bgColorEl.addEventListener('input', (e) => {
        bgColor = e.target.value.toUpperCase();
        bgColorHexEl.value = bgColor;
        bgColorSwatch.style.backgroundColor = bgColor;
        generateQR();
      });

      // Background swatch click -> open color picker
      bgColorSwatch.addEventListener('click', () => {
        bgColorEl.click();
      });

      // Background HEX input -> Color picker sync
      bgColorHexEl.addEventListener('input', (e) => {
        let val = e.target.value;
        if (!val.startsWith('#')) val = '#' + val;
        if (isValidHex(val)) {
          bgColor = val.toUpperCase();
          bgColorEl.value = bgColor;
          bgColorSwatch.style.backgroundColor = bgColor;
          generateQR();
        }
      });

      bgColorHexEl.addEventListener('blur', (e) => {
        let val = e.target.value;
        if (!val.startsWith('#')) val = '#' + val;
        if (!isValidHex(val)) {
          e.target.value = bgColor;
        } else {
          bgColor = val.toUpperCase();
          bgColorEl.value = bgColor;
          bgColorSwatch.style.backgroundColor = bgColor;
          e.target.value = bgColor;
        }
      });

      // Auto-generate function
      let generateTimeout = null;
      function generateQR() {
        const text = (dataEl.value || '').trim();
        if (!text) {
          dlBtn.disabled = true;
          return;
        }
        if (typeof window.qrcode !== 'function') return;

        // Debounce generation
        clearTimeout(generateTimeout);
        generateTimeout = setTimeout(async () => {
          revoke();
          dlBtn.disabled = true;
          const qr = buildQR(text);
          if (ftype === 'svg' || ftype === 'esp') {
            const svg = renderSVG(qr);
            const blob = new Blob([new XMLSerializer().serializeToString(svg)], { type: 'image/svg+xml' });
            lastUrl = URL.createObjectURL(blob);
            lastFmt = ftype === 'esp' ? 'svg' : 'svg';
            previewQREl.innerHTML = '';
            previewQREl.appendChild(svg.cloneNode(true));
          } else {
            const canvas = renderCanvas(qr, resolution);
            const mime = ftype === 'jpg' ? 'image/jpeg' : 'image/png';
            lastUrl = await toBlobUrl(canvas, mime);
            lastFmt = ftype;
            previewQREl.innerHTML = '';
            previewQREl.appendChild(canvas.cloneNode(true));
          }
          dlBtn.disabled = false;
        }, 300);
      }

      styleTabs.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-style]');
        if (!btn) return;
        styleTabs.querySelectorAll('button').forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        style = btn.dataset.style;
        generateQR();
      });

      typeChips.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-type]');
        if (!btn) return;
        typeChips.querySelectorAll('button').forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        ftype = btn.dataset.type;
        generateQR();
      });

      resolutionChips.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-size]');
        if (!btn) return;
        resolutionChips.querySelectorAll('button').forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        resolution = parseInt(btn.dataset.size, 10);
        generateQR();
      });

      // Generate on text input change
      dataEl.addEventListener('input', generateQR);

      let lastUrl = null;
      let lastFmt = null;

      function revoke() {
        if (lastUrl) {
          URL.revokeObjectURL(lastUrl);
          lastUrl = null;
        }
      }

      function buildQR(text) {
        const qr = window.qrcode(0, 'M');
        qr.addData(text);
        qr.make();
        return qr;
      }

      function renderCanvas(qr, targetSize) {
        const modules = qr.getModuleCount();
        const quiet = 4;
        const scale = Math.max(1, Math.floor(targetSize / (modules + 2 * quiet)));
        const size = scale * (modules + 2 * quiet);
        const c = document.createElement('canvas');
        c.width = size;
        c.height = size;
        const ctx = c.getContext('2d');

        // Background
        ctx.fillStyle = bgColor;
        ctx.fillRect(0, 0, size, size);

        // QR shapes
        ctx.fillStyle = qrColor;
        const off = scale * quiet;
        if (style === 'dots') {
          const r = Math.floor(scale * 0.5);
          for (let rIdx = 0; rIdx < modules; rIdx++) {
            for (let cIdx = 0; cIdx < modules; cIdx++) {
              if (qr.isDark(rIdx, cIdx)) {
                const cx = off + cIdx * scale + scale / 2;
                const cy = off + rIdx * scale + scale / 2;
                ctx.beginPath();
                ctx.arc(cx, cy, r, 0, Math.PI * 2);
                ctx.fill();
              }
            }
          }
        } else if (style === 'diamonds') {
          for (let rIdx = 0; rIdx < modules; rIdx++) {
            for (let cIdx = 0; cIdx < modules; cIdx++) {
              if (qr.isDark(rIdx, cIdx)) {
                const x = off + cIdx * scale;
                const y = off + rIdx * scale;
                ctx.save();
                ctx.translate(x + scale / 2, y + scale / 2);
                ctx.rotate(Math.PI / 4);
                ctx.fillRect(-scale / 2, -scale / 2, scale, scale);
                ctx.restore();
              }
            }
          }
        } else if (style === 'hearts') {
          const s = scale * 0.6;
          for (let rIdx = 0; rIdx < modules; rIdx++) {
            for (let cIdx = 0; cIdx < modules; cIdx++) {
              if (qr.isDark(rIdx, cIdx)) {
                const cx = off + cIdx * scale + scale / 2;
                const cy = off + rIdx * scale + scale / 2;
                drawHeart(ctx, cx, cy, s);
              }
            }
          }
        } else if (style === 'stars') {
          const r = scale * 0.5;
          for (let rIdx = 0; rIdx < modules; rIdx++) {
            for (let cIdx = 0; cIdx < modules; cIdx++) {
              if (qr.isDark(rIdx, cIdx)) {
                const cx = off + cIdx * scale + scale / 2;
                const cy = off + rIdx * scale + scale / 2;
                drawStar(ctx, cx, cy, 5, r, r * 0.4);
              }
            }
          }
        } else {
          for (let rIdx = 0; rIdx < modules; rIdx++) {
            for (let cIdx = 0; cIdx < modules; cIdx++) {
              if (qr.isDark(rIdx, cIdx)) {
                ctx.fillRect(off + cIdx * scale, off + rIdx * scale, scale, scale);
              }
            }
          }
        }
        return c;
      }

      function drawHeart(ctx, cx, cy, size) {
        ctx.beginPath();
        const x = cx - size / 2;
        const y = cy - size / 2;
        ctx.moveTo(x + size / 2, y + size);
        ctx.quadraticCurveTo(x, y + size / 3, x, y + size / 3);
        ctx.quadraticCurveTo(x, y, x + size / 4, y);
        ctx.quadraticCurveTo(x + size / 2, y - size / 4, x + size / 2, y - size / 4);
        ctx.quadraticCurveTo(x + size / 2, y - size / 4, x + size * 0.75, y);
        ctx.quadraticCurveTo(x + size, y, x + size, y + size / 3);
        ctx.quadraticCurveTo(x + size, y + size / 3, x + size / 2, y + size);
        ctx.fill();
      }

      function drawStar(ctx, cx, cy, points, outerRadius, innerRadius) {
        ctx.beginPath();
        for (let i = 0; i < points * 2; i++) {
          const radius = i % 2 === 0 ? outerRadius : innerRadius;
          const angle = (i * Math.PI) / points - Math.PI / 2;
          const x = cx + radius * Math.cos(angle);
          const y = cy + radius * Math.sin(angle);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.fill();
      }

      function renderSVG(qr) {
        const modules = qr.getModuleCount();
        const quiet = 4;
        const cell = 8;
        const size = (modules + 2 * quiet) * cell;
        const xmlns = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(xmlns, 'svg');
        svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
        svg.setAttribute('width', size);
        svg.setAttribute('height', size);

        // Background
        const bg = document.createElementNS(xmlns, 'rect');
        bg.setAttribute('fill', bgColor);
        bg.setAttribute('width', size);
        bg.setAttribute('height', size);
        svg.appendChild(bg);

        const g = document.createElementNS(xmlns, 'g');
        g.setAttribute('fill', qrColor);
        svg.appendChild(g);
        const off = quiet * cell;
        for (let r = 0; r < modules; r++) {
          for (let c = 0; c < modules; c++) {
            if (qr.isDark(r, c)) {
              const x = off + c * cell;
              const y = off + r * cell;
              if (style === 'dots') {
                const circ = document.createElementNS(xmlns, 'circle');
                circ.setAttribute('cx', x + cell / 2);
                circ.setAttribute('cy', y + cell / 2);
                circ.setAttribute('r', Math.floor(cell * 0.5));
                g.appendChild(circ);
              } else if (style === 'diamonds') {
                const gg = document.createElementNS(xmlns, 'g');
                gg.setAttribute('transform', `translate(${x + cell / 2} ${y + cell / 2}) rotate(45) translate(${-cell / 2} ${-cell / 2})`);
                const rect = document.createElementNS(xmlns, 'rect');
                rect.setAttribute('width', cell);
                rect.setAttribute('height', cell);
                gg.appendChild(rect);
                g.appendChild(gg);
              } else if (style === 'hearts') {
                const heart = createHeartPath(x + cell / 2, y + cell / 2, cell * 0.6);
                g.appendChild(heart);
              } else if (style === 'stars') {
                const star = createStarPath(x + cell / 2, y + cell / 2, 5, cell * 0.5, cell * 0.2);
                g.appendChild(star);
              } else {
                const rect = document.createElementNS(xmlns, 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', cell);
                rect.setAttribute('height', cell);
                g.appendChild(rect);
              }
            }
          }
        }
        return svg;
      }

      function createHeartPath(cx, cy, size) {
        const xmlns = 'http://www.w3.org/2000/svg';
        const path = document.createElementNS(xmlns, 'path');
        const x = cx - size / 2;
        const y = cy - size / 2;
        const d = `M ${x + size / 2} ${y + size} Q ${x} ${y + size / 3} ${x} ${y + size / 3} Q ${x} ${y} ${x + size / 4} ${y} Q ${x + size / 2} ${y - size / 4} ${x + size / 2} ${y - size / 4} Q ${x + size / 2} ${y - size / 4} ${x + size * 0.75} ${y} Q ${x + size} ${y} ${x + size} ${y + size / 3} Q ${x + size} ${y + size / 3} ${x + size / 2} ${y + size}`;
        path.setAttribute('d', d);
        return path;
      }

      function createStarPath(cx, cy, points, outerRadius, innerRadius) {
        const xmlns = 'http://www.w3.org/2000/svg';
        const path = document.createElementNS(xmlns, 'path');
        let d = '';
        for (let i = 0; i < points * 2; i++) {
          const radius = i % 2 === 0 ? outerRadius : innerRadius;
          const angle = (i * Math.PI) / points - Math.PI / 2;
          const x = cx + radius * Math.cos(angle);
          const y = cy + radius * Math.sin(angle);
          d += (i === 0 ? 'M' : 'L') + ` ${x} ${y}`;
        }
        d += ' Z';
        path.setAttribute('d', d);
        return path;
      }

      async function toBlobUrl(canvas, mime) {
        return new Promise((resolve) => {
          if (canvas.toBlob) {
            canvas.toBlob(b => resolve(URL.createObjectURL(b)), mime, 0.92);
          } else {
            const dataUrl = canvas.toDataURL(mime, 0.92);
            fetch(dataUrl).then(r => r.blob()).then(b => resolve(URL.createObjectURL(b)));
          }
        });
      }

      dlBtn.addEventListener('click', () => {
        if (!lastUrl) return;
        const a = document.createElement('a');
        a.href = lastUrl;
        a.download = `qr-code.${lastFmt}`;
        document.body.appendChild(a);
        a.click();
        a.remove();
      });
    })();
  </script>
</body>
</html>
